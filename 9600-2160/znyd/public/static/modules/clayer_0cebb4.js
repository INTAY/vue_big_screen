/**/_jsload2&&_jsload2('clayer', 'z.extend(pb.prototype,{Uk:{},wj:[],ku:"",Lp:"",bG:"",Vk:q,Gg:q,Fg:q,Eg:[],aG:0,Fy:u(),By:u(),gu:u(),Sd:function(){this.iG()},xa:function(a,b){Mc.prototype.xa.call(this,a,b);this.Uk={};this.wj=[];this.M=a;this.iG()},Qs:da(p),remove:function(){Mc.prototype.remove.call(this);this.gT()},iG:function(){var a=this,b=a.M;b&&(this.Fy=function(b){a.yS(b)},this.By=function(b){a.ZR(b)},this.gu=function(b){a.YR(b)},b.addEventListener("mousemove",this.Fy),b.addEventListener("onhotspotover",this.By),b.addEventListener("onhotspotout", this.gu),b.addEventListener("onzoomstart",this.gu))},gT:function(){var a=this.M;a&&(a.removeEventListener("mousemove",this.Fy),a.removeEventListener("onhotspotover",this.By),a.removeEventListener("onhotspotout",this.gu))},yS:function(a){var b=this,c=b.M,e=c.va();if(c.ja()<this.jc||c.Pd())b.LA();else if(a=e.tk().vg(a.point),e=e.Jd(),a=new R(Math.floor(a.x*Math.pow(2,c.ja()-18)),Math.floor(a.y*Math.pow(2,c.ja()-18))),e=new R(Math.floor(a.x/e),Math.floor(a.y/e)),this.Lp=c=e.x+"_"+e.y+"_"+c.ja(),this.Uk[c]){if(this.ku!= c){b.LA();b.hG(this.Uk[c]);this.ku=c;for(var e=-1,a=0,f=this.wj.length;a<f;a++)if(c==this.wj[a]){e=a;break}0<=e&&(this.wj.splice(e,e),this.wj.push(c))}}else if(this.bG!=c){this.bG=c;e=Vc[parseInt(Math.random()*Vc.length)];a=b.$a;c=e+"/data?grids="+c+"&q="+a.kt+"&tags="+a.bF+"&filter="+a.filter+"&sortby="+a.NN+"&ak="+a.wB+"&page_size="+a.WM+"&age="+a.mJ;b.zf?c+="&geotable_id="+b.zf:b.qn&&(c+="&databox_id="+b.qn);var g=(1E5*Math.random()).toFixed(0);!D._rd&&(D._rd={});D._rd["_cbk"+g]=function(a){b.RR(a); delete D._rd["_cbk"+g]};pa(c+("&callback=BMap._rd._cbk"+g))}},RR:function(a){var b=this.M,c=a.content;if(!(a.status!=this.aG||!c||1>c.length)){for(var a=[],e=c[0].data,b=b.va().tk(),f=0,g=e.length;f<g;f++){var i=e[f][2].replace(pb.tT,"").split(","),i=b.hh(new J(i[0],i[1]));a.push({pt:i,userdata:{name:e[f][0]||"name",size:e[f][4]?e[f][4].split("|"):[10,13],uid:e[f][1]||"",Wb:e[f][3]||"sid1"}})}c=c[0].grid.join("_");this.Uk[c]=a;this.wj.push(c);30<this.wj.length&&(c=this.wj.shift(),delete this.Uk[c], delete c);this.ku!=this.Lp&&(this.LA(),this.Uk[this.Lp]&&(this.hG(this.Uk[this.Lp]),this.ku=this.Lp))}},hG:function(a){for(var b=this.M,c=0,e=a.length;c<e;c++){var f=a[c].userdata.size,g=f[0]/2,f=f[1]/2,g=new kb(a[c].pt,{offsets:[f,g,f,g],userData:a[c].userdata});b.pB(g,this.$a.zD)}},LA:function(){this.M.kw(this.$a.zD)},ZR:function(a){if(a.spots&&!(1>a.spots.length||a.spots[0].tag!=this.$a.zD)){this.Eg=a.spots;var b=this,a=this.Eg[0].getUserData().size[0],c="",e=b.M,f="",g=b.$a.CY;0<this.Eg.length&& (c=this.Eg[0].getUserData().name);if(this.Gg)this.Gg.ua(this.Eg[0].ka()),this.Fg.cd(c),this.Fg.Md(new P(a,0)),this.Gg.show(),c?this.Fg.show():this.Fg.$();else{var i=this.Eg[0].getUserData().size,f=this.Eg[0].getUserData().Wb,k=this.zf||this.qn;this.Vk=new qc(H.sa+"blank.gif",new P(i[0],i[1]),{anchor:new P(i[0]/2+1,i[1]/2+1)});this.IR(k,f,function(){b.Gg&&b.Gg.Vb(b.Vk)});this.Gg=new W(this.Eg[0].ka(),{icon:this.Vk,enableMassClear:t});e.Pa(this.Gg);this.Fg=new uc(c,{offset:new P(a,0)});this.Fg.Nd({backgroundColor:g.backgroundColor, borderColor:g.borderColor});this.Gg.Im(this.Fg);c?this.Fg.show():this.Fg.$();this.Gg.addEventListener("onclick",function(){if(!(b.Eg.length<1)&&b.Eg[0].getUserData().uid){var a=b.$a,c=a.TX;if(b.zf)c=a.UX;a=c+b.Eg[0].getUserData().uid+"?scope=2&ak="+a.wB;b.zf&&(a=a+("&geotable_id="+b.zf));var e=(Math.random()*1E5).toFixed(0);!D._rd&&(D._rd={});D._rd["_cbk"+e]=function(a){b.HR(a);delete D._rd["_cbk"+e]};pa(a+("&callback=BMap._rd._cbk"+e))}})}}},HR:function(a){var b=a.content;this.zf&&(b=a.contents[0]); if(a&&a.status==this.aG&&b){var a={poiId:b.uid||"",databoxId:b.databox_id||"",title:this.zf?b.title:b.name,address:this.zf?b.address:b.addr,phoneNumber:b.tel||"",postcode:b.zip||"",provinceCode:1*b.province_id||-1,province:b.province||"",cityCode:1*b.city_id||-1,city:b.city||"",districtCode:1*b.district_id||-1,district:b.district||"",point:this.zf?new J(b.location[0],b.location[1]):new J(b.longitude,b.latitude),tags:b.tag&&b.tag.replace(pb.wT,"").split(pb.uT),typeId:1*b.cla||-1,extendedData:b.ext|| {}},c=new z.lang.fu("onhotspotclick");c.customPoi=a;c.content=b;this.dispatchEvent(c)}},YR:function(){this.Gg&&this.Gg.$();this.Fg&&this.Fg.$()},IR:function(a,b,c){var e=this,f=Wc+"?method=getstyle&databox="+a+"&sid="+b,g=(1E5*Math.random()).toFixed(0);if(!e.Vk||!(e.Vk.databoxid==a&&e.Vk.sid==b))!D._rd&&(D._rd={}),D._rd["_cbk"+g]=function(a){var b="";0==a.status&&(b="data:image/png;base64,"+a.content.sid1);0<b.length&&(e.Vk.wN(b),c&&c(a));delete D._rd["_cbk"+g]},pa(f+("&callback=BMap._rd._cbk"+g))}}); ');